<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å¿«ä¹ç§¯åˆ†ä¹å›­</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <style>
        /* åŸºç¡€æ ·å¼é‡ç½® */
        * { 
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body { 
            font-family: 'Comic Sans MS', cursive; 
            background: #f9f3e9; 
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            background: #FFB6C1;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .student-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .student-card {
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 2px solid #FFD700;
            transition: transform 0.3s;
        }

        .student-card:hover {
            transform: translateY(-3px);
        }

        .student-id {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .student-name {
            font-weight: bold;
            margin: 5px 0;
            color: #FF69B4;
            font-size: 1.2em;
        }

        .score-box {
            background: #87CEEB;
            border-radius: 10px;
            padding: 8px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .coins-box {
            background: #98FB98;
            border-radius: 10px;
            padding: 8px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .negative { color: red; }

        button {
            background: #FFB6C1;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            margin: 3px;
            cursor: pointer;
            transition: 0.3s;
            font-family: inherit;
        }

        button:hover { 
            transform: scale(1.05);
            filter: brightness(0.95);
        }

        .controls {
            background: #E6E6FA;
            padding: 15px;
            border-radius: 15px;
            margin: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        #modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            border-radius: 15px;
            position: relative;
        }

        input[type="number"] {
            padding: 8px;
            border-radius: 15px;
            border: 2px solid #87CEEB;
            margin: 5px;
            width: 80px;
            font-family: inherit;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>âœ¨ å¿«ä¹ç§¯åˆ†ä¹å›­ âœ¨ <span id="date"></span></h1>
        <div>
            <button onclick="exportData()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
            <button onclick="clearScores()" style="background:#ff9966">ğŸ§¹ æ¸…é™¤ç§¯åˆ†</button>
        </div>
    </div>

    <div class="controls">
        <h3>æ‰¹é‡æ“ä½œ</h3>
        <input type="number" id="batchScore" placeholder="åˆ†æ•°å€¼" min="0">
        <button onclick="batchAdd()">ğŸ‰ å…¨ç­åŠ åˆ†</button>
        <button onclick="batchSubtract()">ğŸŒ€ å…¨ç­å‡åˆ†</button>
        <button onclick="showAddStudent()">â• æ·»åŠ å­¦ç”Ÿ</button>
        <button onclick="showAddPrize()">ğŸ ç®¡ç†å¥–å“</button>
    </div>

    <div class="student-grid" id="studentContainer"></div>

    <div id="modal">
        <div class="modal-content">
            <div id="modalContent"></div>
            <button onclick="closeModal()" style="margin-top:15px">å…³é—­</button>
        </div>
    </div>

    <script>
        // å­¦ç”Ÿåå•
        const fullNameList = ["é™ˆåŠ²æ¡¥","é™ˆçŸè¨€","é™ˆé†‰å¢¨","å•å½¦æ¡","è‹Ÿè½©é¸£","é»ç‘éœ–","æå˜‰é˜³","ææ™¯è€˜","ææ´›äº¦","ææé†","å»–ç¥¯çœŸ","åˆ˜å­æ´‹","è·¯ä¾æ–‡","é©¬å¹³å·","ç‰ŸæŸç„¶","ç‰Ÿæ—æ˜Š","é‚±æ™šå®¸","çŸ³é€¸æœ—","è°­æ¶äºˆ","ç‹ç¿Šä¸","ç‹æ¢“é“­","ç‹æ¢“ç†™","ç†Šç®æ·","æ¨ç§‰å®¸","æ¨éº’æ™”","å°¹é€¸çŸ¥","å¼ å³»æº","å‘¨å­æ§º","æ›¾æ³ŠåŒ€","é™ˆçŸä¼²","é™ˆæ¸…æ¡","é™ˆè‡†ç±³","é™ˆé˜…å¾®","éƒæ´ºä¼Š","èƒ¡å°¹é¦¨","å…°æ€¡éœ–","ææ©éœ–","æéœ²è","åˆ˜èŠ·å¦","æ¢…é”¦é™Œ","æ±¤å©‰æ‰¬","å”ç»´æ—","ç‹æ–½æ‡¿","ç‹å©‰ç³","ç‹å¥•è²","æ–‡ç†å¦","å´ä½©ç‘¶","æ¨ç¿ä¸€","è¢æ²å¸Œ","å¼ éœ²æ¶µ","å¼ æ€ç”œ","å¼ æ–‡å¥•","å¼ é›¨ç¦¾"];

        // åˆå§‹åŒ–å­¦ç”Ÿæ•°æ®
        let students = JSON.parse(localStorage.getItem('students')) || fullNameList.map((name, index) => ({
            id: index+1, 
            name: name, 
            score: 0, 
            coins: 0 
        }));

        let prizes = JSON.parse(localStorage.getItem('prizes')) || [];

        // æ ¸å¿ƒåŠŸèƒ½
        function changeScore(index, delta) {
            students[index].score += delta;
            students[index].coins += delta;
            renderStudents();
        }

        function batchAdd() {
            let score = parseInt(document.getElementById('batchScore').value) || 0;
            students.forEach(s => { 
                s.score += score; 
                s.coins += score; 
            });
            renderStudents();
        }

        function batchSubtract() {
            let score = parseInt(document.getElementById('batchScore').value) || 0;
            students.forEach(s => { 
                s.score = Math.max(0, s.score - score);
                s.coins = Math.max(0, s.coins - score);
            });
            renderStudents();
        }

        // æ¸²æŸ“å­¦ç”Ÿå¡ç‰‡
        function renderStudents() {
            const container = document.getElementById('studentContainer');
            container.innerHTML = students.map((s, index) => `
                <div class="student-card">
                    <div class="student-id">å­¦å·ï¼š${s.id}</div>
                    <div class="student-name">${s.name}</div>
                    
                    <div class="score-box ${s.score < 0 ? 'negative' : ''}">
                        âœ¨ ç§¯åˆ†ï¼š${s.score}
                        <div>
                            <button onclick="changeScore(${index}, 1)">â•</button>
                            <button onclick="changeScore(${index}, -1)">â–</button>
                        </div>
                    </div>
                    
                    <div class="coins-box">
                        ğŸª™ å…‘æ¢å¸ï¼š${s.coins}
                        <button onclick="showRedeem(${index})">å…‘æ¢å¥–å“</button>
                    </div>
                </div>
            `).join('');
            saveData();
        }

        // å­¦ç”Ÿç®¡ç†
        function showAddStudent() {
            document.getElementById('modalContent').innerHTML = `
                <h3>â• æ·»åŠ å­¦ç”Ÿ</h3>
                <input type="text" id="newName" placeholder="å­¦ç”Ÿå§“å" style="padding:8px;width:200px">
                <button onclick="addStudent()" style="margin-top:10px">ç¡®è®¤æ·»åŠ </button>
            `;
            showModal();
        }

        function addStudent() {
            const newName = document.getElementById('newName').value;
            if(newName) {
                students.push({
                    id: students.length + 1,
                    name: newName,
                    score: 0,
                    coins: 0
                });
                closeModal();
                renderStudents();
            }
        }

        // å¥–å“ç®¡ç†
        function showAddPrize() {
            document.getElementById('modalContent').innerHTML = `
                <h3>ğŸ å¥–å“ç®¡ç†</h3>
                <div style="max-height:200px;overflow-y:auto;margin:10px 0">
                    ${prizes.map((p,i) => `
                        <div style="padding:8px;border-bottom:1px solid #eee;display:flex;justify-content:space-between">
                            <div>${p.name}ï¼ˆ${p.cost}å¸ï¼‰</div>
                            <button onclick="deletePrize(${i})" style="padding:2px 8px">åˆ é™¤</button>
                        </div>
                    `).join('')}
                </div>
                <h4>æ·»åŠ æ–°å¥–å“ï¼š</h4>
                <input type="text" id="prizeName" placeholder="å¥–å“åç§°" style="margin:5px">
                <input type="number" id="prizeCost" placeholder="æ‰€éœ€å¸æ•°" min="1" style="margin:5px">
                <button onclick="addPrize()" style="margin-top:10px">æ·»åŠ å¥–å“</button>
            `;
            showModal();
        }

        function addPrize() {
            const name = document.getElementById('prizeName').value;
            const cost = parseInt(document.getElementById('prizeCost').value);
            if(name && cost > 0) {
                prizes.push({ name, cost });
                closeModal();
                showAddPrize();
            }
        }

        function deletePrize(index) {
            if(confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¥–å“å—ï¼Ÿ')) {
                prizes.splice(index, 1);
                showAddPrize();
            }
        }

        // å…‘æ¢åŠŸèƒ½
        function showRedeem(studentIndex) {
            const student = students[studentIndex];
            document.getElementById('modalContent').innerHTML = `
                <h3>ğŸ ${student.name} çš„å…‘æ¢</h3>
                <p style="margin:10px 0">å½“å‰å…‘æ¢å¸ï¼š${student.coins}</p>
                <div style="max-height:300px;overflow-y:auto">
                    ${prizes.map((p, index) => `
                        <div style="padding:8px;border-bottom:1px solid #eee;display:flex;justify-content:space-between">
                            <div>${p.name}ï¼ˆéœ€è¦ ${p.cost} å¸ï¼‰</div>
                            <button onclick="confirmRedeem(${studentIndex}, ${index})" 
                                ${student.coins < p.cost ? 'disabled style="background:#ccc"' : ''}>
                                å…‘æ¢
                            </button>
                        </div>
                    `).join('')}
                </div>
                ${prizes.length === 0 ? '<p style="color:#666;margin:10px 0">æš‚æ— å¥–å“ï¼Œè¯·å…ˆæ·»åŠ </p>' : ''}
            `;
            showModal();
        }

        function confirmRedeem(studentIndex, prizeIndex) {
            const student = students[studentIndex];
            const prize = prizes[prizeIndex];
            
            if(student.coins >= prize.cost) {
                student.coins -= prize.cost;
                renderStudents();
                closeModal();
                alert(`ğŸ‰ å…‘æ¢æˆåŠŸï¼${student.name} è·å¾—ã€${prize.name}ã€‘`);
            } else {
                alert('âš ï¸ å…‘æ¢å¸ä¸è¶³ï¼');
            }
        }

        // é€šç”¨åŠŸèƒ½
        function showModal() { 
            document.getElementById('modal').style.display = 'block'; 
        }
        
        function closeModal() { 
            document.getElementById('modal').style.display = 'none'; 
        }
        
        function saveData() { 
            localStorage.setItem('students', JSON.stringify(students)); 
            localStorage.setItem('prizes', JSON.stringify(prizes)); 
        }
        
        function clearScores() {
            if(confirm('âš ï¸ ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç§¯åˆ†å’Œå…‘æ¢å¸å—ï¼Ÿ')) {
                students.forEach(s => { 
                    s.score = 0; 
                    s.coins = 0; 
                });
                saveData();
                renderStudents();
                alert('âœ… å·²æ¸…é›¶æ‰€æœ‰ç§¯åˆ†ï¼');
            }
        }
        
        function exportData() {
            const wsData = students.map(s => [s.id, s.name, s.score, s.coins]);
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet([['å­¦å·','å§“å','ç§¯åˆ†','å…‘æ¢å¸'], ...wsData]);
            XLSX.utils.book_append_sheet(wb, ws, "å­¦ç”Ÿæ•°æ®");
            XLSX.writeFile(wb, `ç§¯åˆ†æ•°æ®_${new Date().toISOString().slice(0,10)}.xlsx`);
        }

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('date').textContent = new Date().toLocaleDateString();
            renderStudents();
            setInterval(saveData, 300000); // æ¯5åˆ†é’Ÿè‡ªåŠ¨ä¿å­˜
        });
    </script>
</body>
</html>
